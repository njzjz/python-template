# Python Template Project

This is a Python template project for creating new Python packages quickly. It uses modern Python packaging practices with setuptools, setuptools_scm for version management, and comprehensive development tools.

Always reference these instructions first and fallback to search or bash commands only when you encounter unexpected information that does not match the info here.

## Repository Standards

### Conventional Commits and PR Titles

This repository follows [Conventional Commits](https://www.conventionalcommits.org/) specification:

- **PR titles** must follow the pattern: `type(scope): description`
- **Commit messages** should also follow conventional commit format
- Common types: `feat`, `fix`, `docs`, `style`, `refactor`, `test`, `chore`, `ci`, `build`, `perf`
- Examples:
  - `docs: add GitHub Copilot instructions`
  - `chore(deps): update dependency python to 3.13`
  - `feat: add new validation function`
  - `fix: resolve version import issue`

Always use conventional commit format for both PR titles and commit messages when working in this repository.

## Working Effectively

### Bootstrap and Install Dependencies

- Install uv (faster package manager):
  - `pip install uv --user`
  - Takes ~5-10 seconds. NEVER CANCEL. Set timeout to 60+ seconds.

#### Option 1: Using Virtual Environment (Recommended)

- Create virtual environment: `uv venv`
- Activate virtual environment: `source .venv/bin/activate`
- Install package and dependencies: `uv pip install -e . pytest pytest-cov ruff mypy build pre-commit nox`
- Takes ~10-25 seconds total. NEVER CANCEL. Set timeout to 120+ seconds.

#### Option 2: System Installation (Fallback)

- Use pip with --user flag: `pip install -e . pytest pytest-cov ruff mypy build pre-commit nox --user`
- Takes ~30-60 seconds. NEVER CANCEL. Set timeout to 180+ seconds.
- Note: Some systems may block system-wide uv installations; use pip as fallback

### Testing

- Run tests with coverage:
  - `python -m pytest --cov --cov-config pyproject.toml --cov-report term --cov-report xml`
  - Takes ~0.3 seconds. NEVER CANCEL. Set timeout to 60+ seconds for safety.
- Alternative using nox (if network allows):
  - `/home/runner/.local/bin/nox -db uv` or `nox -db uv`
  - Takes ~1-2 minutes including environment setup. NEVER CANCEL. Set timeout to 300+ seconds.

### Linting and Formatting

- Run ruff linting with fixes:
  - `python -m ruff check --fix`
  - Takes ~0.03 seconds. NEVER CANCEL. Set timeout to 60+ seconds for safety.
- Run ruff formatting:
  - `python -m ruff format`
  - Takes ~0.03 seconds. NEVER CANCEL. Set timeout to 60+ seconds for safety.
- Run type checking:
  - `python -m mypy python_template`
  - Takes ~0.3 seconds. NEVER CANCEL. Set timeout to 60+ seconds for safety.

### Building

- Build package (may fail in network-restricted environments):
  - `python -m build`
  - Takes ~30-60 seconds. NEVER CANCEL. Set timeout to 300+ seconds.
  - Requires network access for build dependencies
  - Alternative: `python -m build --no-isolation` after installing `setuptools-scm[toml]`
- If build fails due to network issues, the core functionality still works via editable install

### Pre-commit Hooks (CI Validation)

- Install pre-commit: `uv pip install pre-commit` (if using venv) or `pip install pre-commit --user`
- Install hooks: `pre-commit install`
- Run all checks: `pre-commit run --all-files`
  - Takes ~30-60 seconds. NEVER CANCEL. Set timeout to 180+ seconds.
- Individual CI checks that must pass:
  - `python -m ruff check --fix`
  - `python -m ruff format`
  - `python -m mypy python_template`

## Validation

### Always Run These Validation Steps After Making Changes

1. **Basic functionality test**: `python -c "import python_template; print(python_template.__version__)"`
2. **Run the test suite**: `python -m pytest --cov --cov-config pyproject.toml --cov-report term --cov-report xml`
3. **Lint and format code**:
   - `python -m ruff check --fix`
   - `python -m ruff format`
4. **Type checking**: `python -m mypy python_template`
5. **Verify package contents**: `python -c "import python_template; print(dir(python_template))"`

_Note: If using uv with virtual environment, activate it first: `source .venv/bin/activate`_

### Known Issues and Workarounds

- Network connectivity may prevent `nox`, `python -m build`, and some `uv pip install` commands from working
- If uv is not available, fallback to regular pip: `pip install -e . pytest pytest-cov ruff mypy build pre-commit nox --user`
- The `_version.py` file is auto-generated by setuptools_scm and should not be manually edited
- Some ruff rules are deprecated (ANN101, ANN102) - warnings are expected
- Ruff may report typing-related issues in `_version.py` that cannot be auto-fixed - this is normal for generated files

### Manual Validation Scenarios

When testing changes, follow these complete scenarios:

**Scenario 1: Basic Package Functionality**

1. `python -c "import python_template; print(python_template.__version__)"`
2. Verify output shows a version like `0.1.dev2+g181c8dc78`
3. `python -c "import python_template; print(dir(python_template))"`
4. Verify `__version__` and other expected attributes are present

**Scenario 2: Code Quality and Testing**

1. `python -m pytest --cov --cov-config pyproject.toml --cov-report term --cov-report xml`
2. Verify all tests pass and coverage report shows 100% for main package
3. `python -m ruff check --fix`
4. `python -m ruff format`
5. `python -m mypy python_template`
6. Verify no new issues in the main package (warnings about auto-generated files are OK)

**Scenario 3: Making and Validating Changes**

1. Make your code changes to files in `python_template/`
2. Run basic functionality test: `python -c "import python_template; print(python_template.__version__)"`
3. Run tests: `python -m pytest --cov --cov-config pyproject.toml --cov-report term --cov-report xml`
4. Fix linting: `python -m ruff check --fix && python -m ruff format`
5. Type check: `python -m mypy python_template`
6. Test any new functionality you added manually

## Common Tasks

### Project Structure

```
.
├── README.md
├── pyproject.toml          # Main configuration file
├── noxfile.py             # Nox configuration for test automation
├── .pre-commit-config.yaml # Pre-commit hook configuration
├── .github/
│   └── workflows/
│       ├── test.yaml      # CI testing workflow
│       └── release.yaml   # Release automation
├── python_template/       # Main package directory
│   ├── __init__.py
│   ├── __main__.py
│   ├── _version.py        # Auto-generated version file
│   └── py.typed          # Type annotations marker
└── tests/
    ├── __init__.py
    └── test_version.py
```

### Key Configuration Files

#### pyproject.toml

- Contains all project metadata and tool configurations
- Defines build system (setuptools + setuptools_scm)
- Configures ruff, coverage, and other tools
- Package name, dependencies, and entry points

#### noxfile.py

- Defines test sessions for nox
- Runs pytest with coverage configuration
- Creates isolated test environments

#### .pre-commit-config.yaml

- Defines pre-commit hooks for code quality
- Includes ruff, mypy, and other validation tools
- Matches CI pipeline requirements

### Frequently Used Commands Output

#### Package Import Test

```bash
$ python -c "import python_template; print(python_template.__version__)"
0.1.dev2+g181c8dc78
```

#### Test Execution

```bash
$ python -m pytest --cov --cov-config pyproject.toml --cov-report term
================================================= test session starts ==================================================
collected 1 item

tests/test_version.py .                                                                                          [100%]

==================================================== tests coverage ====================================================
Name                          Stmts   Miss  Cover
-------------------------------------------------
python_template/__init__.py       4      0   100%
python_template/_version.py      13      0   100%
-------------------------------------------------
TOTAL                            17      0   100%
```

#### Repository Root Contents

```bash
$ ls -la
total 56
drwxr-xr-x 6 runner docker 4096 .
drwxr-xr-x 3 runner docker 4096 ..
drwxr-xr-x 7 runner docker 4096 .git
drwxr-xr-x 3 runner docker 4096 .github
-rw-r--r-- 1 runner docker 3166 .gitignore
-rw-r--r-- 1 runner docker  925 .pre-commit-config.yaml
-rw-r--r-- 1 runner docker 7652 LICENSE
-rw-r--r-- 1 runner docker  203 README.md
-rw-r--r-- 1 runner docker  392 noxfile.py
-rw-r--r-- 1 runner docker 1856 pyproject.toml
drwxr-xr-x 2 runner docker 4096 python_template
-rw-r--r-- 1 runner docker  115 renovate.json
drwxr-xr-x 2 runner docker 4096 tests
```

### CI Pipeline Requirements

The GitHub Actions workflow requires these checks to pass:

1. `nox -db uv` (runs tests with coverage)
2. All pre-commit hooks (ruff, mypy, etc.)

Always run the equivalent local commands before committing:

- `python -m pytest --cov --cov-config pyproject.toml --cov-report term --cov-report xml`
- `python -m ruff check --fix`
- `python -m ruff format`
- `python -m mypy python_template`
